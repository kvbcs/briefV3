<div class="list-detail-container" *ngIf="!isLoading && list; else loading">
  <div class="header-actions">
    <div>
      <button class="btn-back" (click)="goBack()">
        &larr; Retour Aux Listes
      </button>
      <h1>{{ list.name }}</h1>
    </div>
    <div class="action-buttons">
      <button class="btn-border" (click)="togglePersonForm()">
        {{ showPersonForm ? "Annuler" : "Ajouter Personne" }}
      </button>
    </div>
  </div>

  <!-- ‚úÖ FORMULAIRE D‚ÄôAJOUT / MODIF PERSONNE -->
  <div *ngIf="showPersonForm" class="person-form-card">
    <h2>
      {{ editingPerson ? "Modifier Personne" : "Ajouter Nouvelle Personne" }}
    </h2>

    <form [formGroup]="personForm" (ngSubmit)="onSubmit()">
      <div class="form-row">
        <div class="form-group">
          <label for="name">Name</label>
          <input
            type="text"
            id="name"
            formControlName="name"
            [ngClass]="{ 'is-invalid': f['name'].invalid && f['name'].touched }"
          />
          <div
            *ngIf="f['name'].invalid && f['name'].touched"
            class="invalid-feedback"
          >
            <div *ngIf="f['name'].errors?.['required']">Name is required</div>
            <div *ngIf="f['name'].errors?.['minlength']">Min 3 characters</div>
            <div *ngIf="f['name'].errors?.['maxlength']">Max 50 characters</div>
          </div>
        </div>

        <div class="form-group">
          <label for="age">Age</label>
          <input
            type="number"
            id="age"
            formControlName="age"
            min="1"
            max="99"
            [ngClass]="{ 'is-invalid': f['age'].invalid && f['age'].touched }"
          />
          <div
            *ngIf="f['age'].invalid && f['age'].touched"
            class="invalid-feedback"
          >
            <div *ngIf="f['age'].errors?.['required']">Age is required</div>
            <div *ngIf="f['age'].errors?.['min'] || f['age'].errors?.['max']">
              Age must be 1‚Äì99
            </div>
          </div>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="gender">Gender</label>
          <select id="gender" formControlName="gender">
            <option *ngFor="let gender of genderOptions" [value]="gender">
              {{ gender }}
            </option>
          </select>
        </div>

        <div class="form-group">
          <label for="profile">Profile</label>
          <select id="profile" formControlName="profile">
            <option *ngFor="let profile of profileOptions" [value]="profile">
              {{ profile }}
            </option>
          </select>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="frenchFluency">French Fluency (1‚Äì4)</label>
          <input
            type="number"
            id="frenchFluency"
            formControlName="frenchFluency"
            min="1"
            max="4"
          />
        </div>

        <div class="form-group">
          <label for="technicalLevel">Technical Level (1‚Äì4)</label>
          <input
            type="number"
            id="technicalLevel"
            formControlName="technicalLevel"
            min="1"
            max="4"
          />
        </div>
      </div>

      <div class="form-group checkbox-group">
        <label>
          <input type="checkbox" formControlName="formerDWWM" />
          Former DWWM
        </label>
      </div>

      <div class="form-actions">
        <button
          type="submit"
          class="btn-border"
          [disabled]="personForm.invalid"
        >
          {{ editingPerson ? "Update" : "Add" }} Person
        </button>
      </div>
    </form>

    <div *ngIf="errorMessage" class="error-msg">
      {{ errorMessage }}
    </div>
  </div>

  <!-- ‚úÖ AFFICHAGE DES PERSONNES -->
  <div *ngIf="list.people.length === 0" class="no-people">
    <p>This list has no people yet. Add some people to get started!</p>
  </div>

  <div *ngIf="list.people.length > 0" class="people-list">
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Age</th>
          <th>Gender</th>
          <th>Profile</th>
          <th>French</th>
          <th>Tech</th>
          <th>DWWM</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let person of list.people">
          <td>{{ person.name }}</td>
          <td>{{ person.age }}</td>
          <td>{{ person.gender }}</td>
          <td>{{ person.profile }}</td>
          <td>{{ person.frenchFluency }}/4</td>
          <td>{{ person.technicalLevel }}/4</td>
          <td>{{ person.formerDWWM ? "Oui" : "Non" }}</td>
          <td class="actions">
            <button
              class="btn-icon edit"
              (click)="togglePersonForm(person)"
              title="Edit"
            >
              ‚úèÔ∏è
            </button>
            <button
              class="btn-icon delete"
              (click)="deletePerson(person)"
              title="Delete"
            >
              üóëÔ∏è
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<ng-template #loading>
  <div class="loading">
    <p>Loading list...</p>
  </div>
</ng-template>
